print(flags[155, ], width = Inf)
View(flags)
dim(flags)
summary(flags)\
summary(flags)
as.list(flags)
cls_list <- lapply(flags, class)
cls_list
sapply(flags, class)
cls_vector <- sapply(flags, class)
cls_vector
as.data.frame(cls_list)
class(cls_vector)
flags_colors <- flags[, 11:17]
head(flags_colors)
lapply(flags_colors, sum)
sapply(flags_colors, sum)
flag_shape <- flags[, 19:23]
flag_shape
lapply(flag_shape, range)
sapply(flag_shape, range)
unique(c(3, 4, 4, 5, 6, 2, 1, 3, 2, 5, 10, 4))
unique_vals <- lapply(flags, unique)
unique_vals
sapply(flags, unique)
unique_vals <- lapply(flags, unique)
lapply(unique_vals, function(elem) elem[2])
vapply(flags, class, character[1])
vapply(flags, class, character)
vapply(flags, class, character(1))
?vapply
table(flags$landmass)
tapply(flags$animate, flags$landmass, sum)
tapply(flags$animate, flags$landmass, mean)
flags$landmass
tapply(flags$population, flags$red, summary)
tapply(flags$population, flags$landmass, summary)
sample(1:6, 4, replace = TRUE)
sample(1:6, 4, replace = FALSE)
markdown("2016-03-28-visualize-pokemon.Rmd", "Visualizing/")
markdown("2016-03-28-visualize-pokemon.Rmd", "Visualizing/")
fonts()
fonts()
hctsne
hctsne <- highchart() %>%
hc_chart(zoomType = "xy") %>%
hc_xAxis(minRange = diff(range(pokemon$x))/5) %>%
hc_yAxis(minRange = diff(range(pokemon$y))/5) %>%
hc_add_series(data = ds,
type = "scatter",
name = "pokemons",
states = list(hover = list(halo = list(
size  = 50,
attributes = list(
opacity = 1)
)))) %>%
hc_add_series(data = ds2, type = "scatter",
marker = list(radius = 75, symbol = "circle"),
zIndex = -3,  enableMouseTracking = FALSE,
linkedTo = ":previous") %>%
hc_plotOptions(series = list()) %>%
hc_tooltip(
useHTML = TRUE,
borderRadius = 0,
borderWidth = 5,
headerFormat = "<table>",
pointFormat = tooltip,
footerFormat = "</table>"
) %>%
hc_add_theme(
hc_theme_null(
chart = list(
backgroundColor = "transparent",
style = list(
fontFamily = "KoPubDotum Medium"
)
)
)
)
hctsne
# Chunk 1: setup
knitr::opts_chunk$set(fig.retina = 2)
library(printr)
# Chunk 2
library(dplyr)
# Chunk 3
library(rvest)
url <- "https://ko.wikipedia.org/wiki/%ED%8F%AC%EC%BC%93%EB%AA%AC_%EB%AA%A9%EB%A1%9D"
wiki_poke <- read_html(url)
first_gen <- wiki_poke %>%
html_nodes(xpath='//*[@id="mw-content-text"]/table[1]') %>%
html_table() %>%
.[[1]]
second_gen <- wiki_poke %>%
html_nodes(xpath='//*[@id="mw-content-text"]/table[2]') %>%
html_table() %>%
.[[1]]
poke_list_ko <- c(first_gen[, 2], second_gen[, 2])
# Chunk 5
library(dplyr)
library(tidyr)
library(stringr)
library(purrr) # map_df()
library(readr) # read_csv() // 한글 포함된 파일에선 문제 발생
path <- function(x) paste0("https://raw.githubusercontent.com/phalt/pokeapi/master/data/v2/csv/", x)
pkmn <- read_csv(path("pokemon.csv")) %>%
select(-(order : is_default)) %>%
rename(pokemon = identifier)
stat <- read_csv(path("stats.csv")) %>%
rename(stat_id = id) %>%
right_join(read_csv(path("pokemon_stats.csv")),
by = "stat_id") %>%
mutate(identifier = str_replace(identifier, "-", "_")) %>%
select(pokemon_id, identifier, base_stat) %>%
spread(identifier, base_stat) %>%
rename(id = pokemon_id)
type <- read_csv(path("types.csv")) %>%
rename(type_id = id) %>%
right_join(read_csv(path("pokemon_types.csv")),
by = "type_id") %>%
select(pokemon_id, identifier, slot) %>%
mutate(slot = paste0("type_", slot)) %>%
spread(slot, identifier) %>%
rename(id = pokemon_id)
egg <- read_csv(path("egg_groups.csv")) %>%
rename(egg_group_id = id) %>%
right_join(read_csv(path("pokemon_egg_groups.csv")),
by = "egg_group_id") %>%
group_by(species_id) %>%
mutate(ranking = row_number(),
ranking = paste0("egg_group_", ranking)) %>%
select(species_id, ranking, identifier) %>%
spread(ranking, identifier)
img <- "https://github.com/phalt/pokeapi/tree/master/data/Pokemon_XY_Sprites" %>%
read_html() %>%
html_nodes("tr.js-navigation-item > .content > .css-truncate a") %>%
map_df(function(x){
url <- x %>% html_attr("href")
data_frame(
id = str_extract(basename(url), "\\d+"),
url_image = basename(url)
)
}) %>%
mutate(id = as.numeric(id))
url_bulbapedia_list <- "http://bulbapedia.bulbagarden.net/wiki/List_of_Pok%C3%A9mon_by_base_stats_(Generation_VI-present)"
id <- url_bulbapedia_list %>%
read_html(encoding = "UTF-8") %>%
html_node("table.sortable") %>%
html_table() %>%
.[[1]] %>%
as.numeric()
url_icon <-  url_bulbapedia_list %>%
read_html() %>%
html_nodes("table.sortable img") %>%
html_attr("src")
icon <- data_frame(id, url_icon) %>%
filter(!is.na(id)) %>%
distinct(id)
color <- map_df(na.omit(unique(c(type$type_1, type$type_2))), function(t){
# t <- "bug"
col <- "http://pokemon-uranium.wikia.com/wiki/Template:%s_color" %>%
sprintf(t) %>%
read_html() %>%
html_nodes("span > b") %>%
html_text()
data_frame(type = t, color = paste0("#", col))
})
colorf <- expand.grid(color_1 = color$color, color_2 = color$color,
stringsAsFactors = FALSE) %>%
group_by(color_1, color_2) %>%
do({
n = 100; p = 0.27
data_frame(color_f = colorRampPalette(c(.$color_1, .$color_2))(n)[round(n*p)])
# colorRampPalette(a, b)(n)[m]는 a 색깔부터 b 색깔까지의
# 그라디언트 색 n 개를 생성해서 m 번째 색을 선택하는 함수
# 이상해씨와 같이 풀 타입과 독 타입을 같이 가지고 있는 경우,
# 위 함수를 써서 포켓몬을 나타내는 색을 지정한다.
})
pokemon <- pkmn %>%
left_join(type, by = "id") %>%
left_join(stat, by = "id") %>%
left_join(color %>% rename(type_1 = type, color_1 = color), by = "type_1") %>%
left_join(color %>% rename(type_2 = type, color_2 = color), by = "type_2") %>%
left_join(colorf, by =  c("color_1", "color_2")) %>%
left_join(egg, by = "species_id") %>%
left_join(img, by = "id") %>%
left_join(icon, by = "id") %>%
.[1:251, ]
# 포켓몬 이름을 한글로 바꿔준다.
pokemon["pokemon"] <- poke_list_ko
# Chunk 6
pokemon <- pokemon %>%
mutate(color_f = ifelse(is.na(color_f), color_1, color_f)) %>%
filter(!is.na(url_image))
head(pokemon)
# Chunk 7
library(Hmisc)
library(highcharter)
pokemon$type_1 <- capitalize(pokemon$type_1)
pokemon$type_2 <- capitalize(pokemon$type_2)
dstype <- pokemon %>%
count(type_1, color_1) %>%
ungroup() %>%
arrange(desc(n)) %>%
rename(name = type_1,
color = color_1,
y = n) %>%
select(y, name, color) %>%
list.parse3()
type_bar <- highchart() %>%
hc_xAxis(categories = unlist(pluck(dstype, i = 2))) %>%
hc_yAxis(title = NULL) %>%
hc_add_series(data = dstype, type = "bar", showInLegend = FALSE,
name = "Number of Species")
type_bar
# Chunk 8
set.seed(3514)
library(treemap)
tm <- pokemon %>%
mutate(type_2 = ifelse(is.na(type_2), paste("Only", type_1), type_2),
type_1 = type_1) %>%
group_by(type_1, type_2) %>%
summarise(n = n()) %>%
ungroup() %>%
treemap(index = c("type_1", "type_2"),
vSize = "n", vColor = "type_1")
# Chunk 9
tm$tm <- tm$tm %>%
tbl_df() %>%
left_join(pokemon %>% select(type_1, type_2, color_f) %>%
distinct(), by = c("type_1", "type_2")) %>%
left_join(pokemon %>% select(type_1, color_1) %>%
distinct(), by = c("type_1")) %>%
mutate(type_1 = paste0("Main Type is ", type_1),
color = ifelse(is.na(color_f), color_1, color_f))
hctm <- highchart() %>%
hc_add_series_treemap(tm, allowDrillToNode = TRUE,
layoutAlgorithm = "squarified")
hctm
# Chunk 10
library(tsne)
library(ggplot2)
set.seed(13242)
tsne_poke <- pokemon %>%
select(type_1, type_2, weight, height, base_experience,
attack, defense, special_attack, special_defense, speed,
hp, egg_group_1, egg_group_2) %>%
map(function(x){
ifelse(is.na(x), "NA", x)
}) %>%
as.data.frame() %>%
tbl_df() %>%
model.matrix(~., data = .) %>%
as.data.frame() %>%
tbl_df() %>%
.[-1] %>%
tsne(perplexity = 60)
pokemon <- pokemon %>%
mutate(x = tsne_poke[, 1],
y = tsne_poke[, 2])
poke_centers <- pokemon %>%
group_by(type_1, color_1) %>%
summarise(cx = mean(x), cy = mean(y),
sdcx = sd(x), sdcy = sd(y))
cols <- pokemon %>%
select(type_1, color_1) %>%
distinct() %>%
{setNames(.$color_1, .$type_1)}
type_plot <- ggplot(pokemon) +
geom_point(aes(x, y, color = type_1), size = 4, alpha = 0.5) +
scale_color_manual("Type", values = cols) +
geom_text(data = poke_centers, aes(cx, cy, label = type_1), family = "OpenSans-CondensedBold") +
theme_minimal(base_family = "OpenSans-CondensedLight") +
theme(legend.position = "right",
plot.title = element_text(family = "OpenSans-CondensedBold")) +
facet_wrap(~type_1) +
xlab("") + ylab("") + ggtitle("Pokémon Type")
type_plot
# Chunk 11
ds <- pokemon %>%
select(pokemon, type_1, type_2, weight, height,
attack, defense, special_attack, special_defense,
url_image, url_icon, color = color_1, x, y) %>%
list.parse3() %>%
map(function(x){
x$marker$symbol <- sprintf("url(%s)", x$url_icon)
x$marker$radius <- 2
x$url_icon <- NULL
x
})
ds2 <- pokemon %>%
select(color = color_1, x, y) %>%
mutate(color = hex_to_rgba(color, 0.15)) %>%
list.parse3()
# Chunk 12
library(htmltools)
urlimage <- "https://raw.githubusercontent.com/phalt/pokeapi/master/data/Pokemon_XY_Sprites/"
tooltip <- c("pokemon", "type_1", "type_2",
"weight", "height", "attack", "defense",
"special_attack", "special_defense") %>%
map(function(x){
tags$tr(
tags$th(str_replace_all(str_to_title(x), "_", " ")),
tags$td(paste0("{point.", x, "}"))
)
}) %>%
do.call(tagList, .) %>%
tagList(
tags$img(src = paste0(urlimage, "{point.url_image}"),
width = "125px", height = "125px")
) %>%
as.character()
# Chunk 13
hctsne <- highchart() %>%
hc_chart(zoomType = "xy") %>%
hc_xAxis(minRange = diff(range(pokemon$x))/5) %>%
hc_yAxis(minRange = diff(range(pokemon$y))/5) %>%
hc_add_series(data = ds,
type = "scatter",
name = "pokemons",
states = list(hover = list(halo = list(
size  = 50,
attributes = list(
opacity = 1)
)))) %>%
hc_add_series(data = ds2, type = "scatter",
marker = list(radius = 75, symbol = "circle"),
zIndex = -3,  enableMouseTracking = FALSE,
linkedTo = ":previous") %>%
hc_plotOptions(series = list()) %>%
hc_tooltip(
useHTML = TRUE,
borderRadius = 0,
borderWidth = 5,
headerFormat = "<table>",
pointFormat = tooltip,
footerFormat = "</table>"
) %>%
hc_add_theme(
hc_theme_null(
chart = list(
backgroundColor = "transparent",
style = list(
fontFamily = "KoPubDotum Medium"
)
)
)
)
hctsne
markdown("2016-03-28-visualize-pokemon.Rmd", "Visualizing/")
library(stringi)
?str_to_title
dog <- "The quick brown dog"
str_to_upper(dog)
str_to_lower(dog)
str_to_title(dog)
library(htmltools)
library(stringi)
urlimage <- "https://raw.githubusercontent.com/phalt/pokeapi/master/data/Pokemon_XY_Sprites/"
tooltip <- c("pokemon", "type_1", "type_2",
"weight", "height", "attack", "defense",
"special_attack", "special_defense") %>%
map(function(x){
tags$tr(
tags$th(str_to_title(str_replace_all(x), "_", " ")),
tags$td(paste0("{point.", x, "}"))
)
}) %>%
do.call(tagList, .) %>%
tagList(
tags$img(src = paste0(urlimage, "{point.url_image}"),
width = "125px", height = "125px")
) %>%
as.character()
str_replace_all(str_to_title(x), "_", " ")
x
str_replace_all(str_to_title(dog), "_", " ")
dog <- "the_quick_brown_dog"
str_replace_all(str_to_title(dog), "_", " ")
str_to_title(str_replace_all(dog, "_", " "))
library(htmltools)
library(stringi)
urlimage <- "https://raw.githubusercontent.com/phalt/pokeapi/master/data/Pokemon_XY_Sprites/"
tooltip <- c("pokemon", "type_1", "type_2",
"weight", "height", "attack", "defense",
"special_attack", "special_defense") %>%
map(function(x){
tags$tr(
tags$th(str_to_title(str_replace_all(x), "_", " ")),
tags$td(paste0("{point.", x, "}"))
)
}) %>%
do.call(tagList, .) %>%
tagList(
tags$img(src = paste0(urlimage, "{point.url_image}"),
width = "125px", height = "125px")
) %>%
as.character()
str_to_title(str_replace_all(x), "_", " ")
str_to_title(str_replace_all(dog, "_", " "))
library(htmltools)
library(stringi)
urlimage <- "https://raw.githubusercontent.com/phalt/pokeapi/master/data/Pokemon_XY_Sprites/"
tooltip <- c("pokemon", "type_1", "type_2",
"weight", "height", "attack", "defense",
"special_attack", "special_defense") %>%
map(function(x){
tags$tr(
tags$th(str_to_title(str_replace_all(x, "_", " ")),
tags$td(paste0("{point.", x, "}"))
)
}) %>%
do.call(tagList, .) %>%
tagList(
tags$img(src = paste0(urlimage, "{point.url_image}"),
width = "125px", height = "125px")
) %>%
as.character()
library(dplyr)
library(htmltools)
library(stringi)
urlimage <- "https://raw.githubusercontent.com/phalt/pokeapi/master/data/Pokemon_XY_Sprites/"
tooltip <- c("pokemon", "type_1", "type_2",
"weight", "height", "attack", "defense",
"special_attack", "special_defense") %>%
map(function(x){
tags$tr(
tags$th(str_to_title(str_replace_all(x, "_", " ")),
tags$td(paste0("{point.", x, "}"))
)
}) %>%
do.call(tagList, .) %>%
tagList(
tags$img(src = paste0(urlimage, "{point.url_image}"),
width = "125px", height = "125px")
) %>%
as.character()
library(htmltools)
library(stringi)
urlimage <- "https://raw.githubusercontent.com/phalt/pokeapi/master/data/Pokemon_XY_Sprites/"
tooltip <- c("pokemon", "type_1", "type_2",
"weight", "height", "attack", "defense",
"special_attack", "special_defense") %>%
map(function(x){
tags$tr(
tags$th(str_to_title(str_replace_all(x, "_", " "))),
tags$td(paste0("{point.", x, "}"))
)
}) %>%
do.call(tagList, .) %>%
tagList(
tags$img(src = paste0(urlimage, "{point.url_image}"),
width = "125px", height = "125px")
) %>%
as.character()
tooltip
library(htmltools)
library(stringi)
urlimage <- "https://raw.githubusercontent.com/phalt/pokeapi/master/data/Pokemon_XY_Sprites/"
tooltip <- c("pokemon", "type_1", "type_2",
"weight", "height", "attack", "defense",
"special_attack", "special_defense") %>%
map(function(x){
tags$tr(
tags$th(str_to_title(str_replace_all(x, "_", " "))),
tags$td(paste0("{point.", x, "}"))
)
}) %>%
do.call(tagList, .) %>%
tagList(
tags$img(src = paste0(urlimage, "{point.url_image}"),
width = "125px")
) %>%
as.character()
hctsne <- highchart() %>%
hc_chart(zoomType = "xy") %>%
hc_xAxis(minRange = diff(range(pokemon$x))/5) %>%
hc_yAxis(minRange = diff(range(pokemon$y))/5) %>%
hc_add_series(data = ds,
type = "scatter",
name = "pokemons",
states = list(hover = list(halo = list(
size  = 50,
attributes = list(
opacity = 1)
)))) %>%
hc_add_series(data = ds2, type = "scatter",
marker = list(radius = 75, symbol = "circle"),
zIndex = -3,  enableMouseTracking = FALSE,
linkedTo = ":previous") %>%
hc_plotOptions(series = list()) %>%
hc_tooltip(
useHTML = TRUE,
borderRadius = 0,
borderWidth = 5,
headerFormat = "<table>",
pointFormat = tooltip,
footerFormat = "</table>"
) %>%
hc_add_theme(
hc_theme_null(
chart = list(
backgroundColor = "transparent",
style = list(
fontFamily = "KoPubDotum Medium"
)
)
)
)
hctsne
markdown("2016-03-28-visualize-pokemon.Rmd", "Visualizing/")
markdown("2016-03-28-visualize-pokemon.Rmd", "Visualizing/")
